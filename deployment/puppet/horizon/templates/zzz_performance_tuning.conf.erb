#
# This file autogenerated by Puppet
# Do not edit, changes will be overwritten
#
<%
if @memorysize_mb.to_i < 4100
  max_clients = 100
else
  max_clients = Integer(@memorysize_mb.to_i / 40)
end

if @processorcount.to_i <= 2
  start_servers = 2
else
  start_servers = @processorcount.to_i
end

if @osfamily == 'RedHat' %>
<IfModule prefork.c>
    StartServers        <%= start_servers %>
    MinSpareServers     <%= start_servers %>
    MaxSpareServers     <%= Integer(max_clients / 2) %>
    ServerLimit         <%= max_clients %>
    MaxClients          <%= max_clients %>
    MaxRequestsPerChild  4000
</IfModule>

<IfModule worker.c>
    StartServers        <%= start_servers %>
    ServerLimit         <%= Integer(max_clients * 4 / 25) %>
    MaxClients          <%= Integer(max_clients * 4) %>
    MinSpareThreads     25
    MaxSpareThreads     <%= Integer(max_clients * 2) %>
    ThreadsPerChild     25
    MaxRequestsPerChild  0
</IfModule>

<IfModule event.c>
    StartServers        <%= start_servers %>
    ServerLimit         <%= Integer(max_clients * 4 / 25) %>
    MaxClients          <%= Integer(max_clients * 4) %>
    MinSpareThreads     25
    MaxSpareThreads     <%= Integer(max_clients * 2) %>
    ThreadsPerChild     25
    MaxRequestsPerChild  0
</IfModule>
<% 
end 
if @osfamily == 'Debian' %>
<IfModule mpm_prefork_module>
    StartServers        <%= start_servers %>
    MinSpareServers     <%= start_servers %>
    MaxSpareServers     <%= Integer(max_clients / 2) %>
    ServerLimit         <%= max_clients %>
    MaxClients          <%= max_clients %>
    MaxRequestsPerChild  4000
</IfModule>

<IfModule mpm_worker_module>
    StartServers        <%= start_servers %>
    ServerLimit         <%= Integer(max_clients * 4 / 25) %>
    MaxClients          <%= Integer(max_clients * 4) %>
    MinSpareThreads     25
    MaxSpareThreads     <%= Integer(max_clients * 2) %>
    ThreadsPerChild     25
    MaxRequestsPerChild  0
</IfModule>

<IfModule mpm_event_module>
    StartServers        <%= start_servers %>
    ServerLimit         <%= Integer(max_clients * 4 / 25) %>
    MaxClients          <%= Integer(max_clients * 4) %>
    MinSpareThreads     25
    MaxSpareThreads     <%= Integer(max_clients * 2) %>
    ThreadsPerChild     25
    MaxRequestsPerChild  0
</IfModule>
<% end %>
