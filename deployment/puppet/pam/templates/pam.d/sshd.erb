#%PAM-1.0
<% if scope.lookupvar('pam::pamd::pam_tally2') == true then -%>
auth       <%= scope.lookupvar('pam::pamd::pam_tally2_auth_set') %>
<% end -%>
auth       required     pam_sepermit.so
auth       include      password-auth
<% if scope.lookupvar('pam::pamd::pam_tally2') == true then -%>
account    <%= scope.lookupvar('pam::pamd::pam_tally2_account') %>
<% end -%>
account    required     pam_nologin.so
account    include      password-auth
password   include      password-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open env_params
session    optional     pam_keyinit.so force revoke
session    include      password-auth