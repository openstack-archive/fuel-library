description "The dispynode daemon"
author "Igor Gajsin <igajsin@mirantis.com>"

start on runlevel [2345]
stop on runlevel [!2345]

chdir /var/run

respawn
respawn limit 20 5
kill timeout 65
limit nofile 65535 65535

pre-start script
	mkdir -p <%= @workdir %>
	chown <%= @user %>:<%= @user %> <%= @workdir %>
	mkdir -p /tmp/<%= @user %>/node
	chown <%= @user %>:<%= @user %> /tmp/<%= @user %>/node

end script

script
	[ -x "/usr/bin/dispynode.py" ] || exit 0
	DAEMON_ARGS="--daemon  --name <%= @fqdn %> --ip_addr <%= @admin_iface_ip%>"

	exec start-stop-daemon --start --chdir <%= @workdir %> \
		--chuid <%= @user %>:<%= @user %> --make-pidfile \
		--pidfile /var/run/dispy/<%= @project %>.py.pid \
		--exec /usr/bin/dispynode.py -- ${DAEMON_ARGS}
end script
