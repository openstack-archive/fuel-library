# managed by puppet

"<%= @logpath %>/daily.log"
{
# This file handles the rotation of the daily.log file and also manages the
# atop binary files. It will keep binary files for last <%= @rotate %> days
# instead of 30 days provided by atop.
# Do not modify its settings if not sure
  daily
  rotate <%= @rotate %>
  nocompress
  nocreate
  missingok
  dateext
  copytruncate
  sharedscripts
  lastaction
<% if @osfamily == 'RedHat' -%>
    /bin/find <%= @logpath %> -type f -name 'atop_*' -mtime +<%= @rotate %> -delete
<% elsif @osfamily == 'Debian' -%>
    /usr/bin/find <%= @logpath %> -type f -name 'atop_*' -mtime +<%= @rotate %> -delete
<% else -%>
    /bin/sh -c "find <%= @logpath %> -type f -name 'atop_*' -mtime +<%= @rotate %> -delete"
<% end -%>
    /bin/ln -f -s <%= @logpath %>/atop_$(date +%Y%m%d) <%= @logpath %>/atop_current
  endscript
}
